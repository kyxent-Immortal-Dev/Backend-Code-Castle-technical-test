# üè™ M√≥dulo de Inventario - SystemInventary

## üéØ **Descripci√≥n General**

El **M√≥dulo de Inventario** es un sistema completo para la gesti√≥n de productos, proveedores y compras. Est√° dise√±ado con arquitectura limpia, siguiendo las mejores pr√°cticas de Laravel y utilizando el patr√≥n Repository junto con FormRequest para validaciones robustas.

## üóÑÔ∏è **Modelos del Sistema**

### 1. **Product (Producto)**
**Ubicaci√≥n:** `app/Models/Product.php`

**Campos:**
- `id` - Identificador √∫nico
- `name` - Nombre del producto (255 caracteres, √∫nico)
- `description` - Descripci√≥n detallada (opcional, 1000 caracteres)
- `unit_price` - Precio unitario (decimal 10,2)
- `stock` - Cantidad disponible en inventario (entero)
- `is_active` - Estado activo/inactivo (boolean)
- `created_at`, `updated_at` - Timestamps

**Relaciones:**
- `purchaseDetails()` - HasMany con PurchaseDetail

**M√©todos Principales:**
```php
// Gesti√≥n de stock
$product->increaseStock(10);        // Aumenta stock
$product->decreaseStock(5);         // Disminuye stock
$product->hasStock(3);              // Verifica disponibilidad

// Scopes √∫tiles
Product::active();                  // Solo productos activos
Product::inStock();                 // Solo con stock disponible
Product::lowStock();                // Stock bajo (< 10)

// Atributos calculados
$product->inventory_value;          // Valor total del inventario
$product->formatted_price;          // Precio formateado
$product->stock_status;             // Estado del stock
```

### 2. **Supplier (Proveedor)**
**Ubicaci√≥n:** `app/Models/Supplier.php`

**Campos:**
- `id` - Identificador √∫nico
- `name` - Nombre del proveedor (255 caracteres)
- `email` - Email de contacto (255 caracteres, √∫nico)
- `phone` - Tel√©fono (20 caracteres, opcional)
- `address` - Direcci√≥n (opcional, 500 caracteres)
- `is_active` - Estado activo/inactivo (boolean)
- `created_at`, `updated_at` - Timestamps

**Relaciones:**
- `purchases()` - HasMany con Purchase

**M√©todos Principales:**
```php
// Informaci√≥n del proveedor
$supplier->getTotalPurchases();     // Total de compras
$supplier->getTotalAmount();        // Monto total de compras
$supplier->getLastPurchase();       // √öltima compra

// Scopes √∫tiles
Supplier::active();                 // Solo proveedores activos

// Atributos formateados
$supplier->formatted_phone;         // Tel√©fono formateado
$supplier->summary;                 // Resumen completo
```

### 3. **Purchase (Compra)**
**Ubicaci√≥n:** `app/Models/Purchase.php`

**Campos:**
- `id` - Identificador √∫nico
- `supplier_id` - ID del proveedor (foreign key)
- `user_id` - ID del usuario que registra (foreign key)
- `purchase_date` - Fecha de compra (date)
- `total_amount` - Monto total (decimal 12,2)
- `status` - Estado: pending, completed, cancelled
- `notes` - Notas adicionales (opcional, 1000 caracteres)
- `created_at`, `updated_at` - Timestamps

**Estados:**
- `pending` - Pendiente
- `completed` - Completada
- `cancelled` - Cancelada

**Relaciones:**
- `supplier()` - BelongsTo con Supplier
- `user()` - BelongsTo con User
- `details()` - HasMany con PurchaseDetail

**M√©todos Principales:**
```php
// Gesti√≥n de estados
$purchase->markAsCompleted();       // Marca como completada
$purchase->markAsCancelled();       // Marca como cancelada

// Verificaciones
$purchase->isPending();             // ¬øEst√° pendiente?
$purchase->isCompleted();           // ¬øEst√° completada?

// C√°lculos
$purchase->calculateTotal();        // Calcula total
$purchase->getTotalItems();         // Total de productos

// Scopes √∫tiles
Purchase::pending();                // Solo pendientes
Purchase::completed();              // Solo completadas
Purchase::dateRange($start, $end); // Por rango de fechas
```

### 4. **PurchaseDetail (Detalle de Compra)**
**Ubicaci√≥n:** `app/Models/PurchaseDetail.php`

**Campos:**
- `id` - Identificador √∫nico
- `purchase_id` - ID de la compra (foreign key)
- `product_id` - ID del producto (foreign key)
- `quantity` - Cantidad comprada (entero)
- `purchase_price` - Precio de compra unitario (decimal 10,2)
- `subtotal` - Subtotal de la l√≠nea (decimal 12,2)
- `created_at`, `updated_at` - Timestamps

**Relaciones:**
- `purchase()` - BelongsTo con Purchase
- `product()` - BelongsTo con Product

**Caracter√≠sticas Especiales:**
- **C√°lculo autom√°tico de subtotal** - Se calcula autom√°ticamente antes de guardar
- **√çndice √∫nico compuesto** - Evita productos duplicados en la misma compra

## üèóÔ∏è **Arquitectura del Sistema**

### **Patr√≥n Repository**
Cada modelo tiene su repositorio correspondiente:

1. **ProductRepository** - Gesti√≥n de productos e inventario
2. **SupplierRepository** - Gesti√≥n de proveedores
3. **PurchaseRepository** - Gesti√≥n de compras y stock

### **FormRequest para Validaciones**
Validaciones robustas y organizadas:

1. **StoreProductRequest** - Crear productos
2. **UpdateProductRequest** - Actualizar productos
3. **SearchProductRequest** - Buscar productos
4. **StoreSupplierRequest** - Crear proveedores
5. **UpdateSupplierRequest** - Actualizar proveedores
6. **StorePurchaseRequest** - Registrar compras

### **Controladores Organizados**
1. **ProductController** - CRUD completo de productos
2. **SupplierController** - CRUD completo de proveedores
3. **PurchaseController** - Gesti√≥n de compras y stock

## üöÄ **Funcionalidades Principales**

### **Gesti√≥n de Productos**
- ‚úÖ Crear, leer, actualizar y eliminar productos
- ‚úÖ B√∫squeda avanzada con m√∫ltiples criterios
- ‚úÖ Gesti√≥n de stock autom√°tica
- ‚úÖ Productos con stock bajo y sin stock
- ‚úÖ Estad√≠sticas del inventario
- ‚úÖ Filtros por precio, estado y disponibilidad

### **Gesti√≥n de Proveedores**
- ‚úÖ CRUD completo de proveedores
- ‚úÖ Validaci√≥n de email √∫nico
- ‚úÖ Formateo autom√°tico de tel√©fonos
- ‚úÖ Estad√≠sticas de compras por proveedor
- ‚úÖ Proveedores activos/inactivos

### **Sistema de Compras**
- ‚úÖ Registro de compras con m√∫ltiples productos
- ‚úÖ **Actualizaci√≥n autom√°tica de stock** al completar compras
- ‚úÖ Estados de compra (pendiente, completada, cancelada)
- ‚úÖ Validaciones complejas (productos duplicados, proveedores activos)
- ‚úÖ C√°lculo autom√°tico de totales
- ‚úÖ Historial completo de compras

### **Gesti√≥n de Stock**
- ‚úÖ **Aumento autom√°tico** al completar compras
- ‚úÖ **Disminuci√≥n controlada** (con validaciones)
- ‚úÖ Alertas de stock bajo
- ‚úÖ Valor total del inventario
- ‚úÖ Trazabilidad completa

## üìä **Endpoints de la API**

### **Productos**
```
GET    /api/products              - Listar productos
POST   /api/products              - Crear producto
GET    /api/products/{id}         - Ver producto
PUT    /api/products/{id}         - Actualizar producto
DELETE /api/products/{id}         - Eliminar producto
PATCH  /api/products/{id}/toggle  - Cambiar estado
GET    /api/products/low-stock    - Stock bajo
GET    /api/products/out-of-stock - Sin stock
GET    /api/products/stats        - Estad√≠sticas
GET    /api/products/price-range  - Por rango de precios
```

### **Proveedores**
```
GET    /api/suppliers             - Listar proveedores
POST   /api/suppliers             - Crear proveedor
GET    /api/suppliers/{id}        - Ver proveedor
PUT    /api/suppliers/{id}        - Actualizar proveedor
DELETE /api/suppliers/{id}        - Eliminar proveedor
PATCH  /api/suppliers/{id}/toggle - Cambiar estado
GET    /api/suppliers/active      - Proveedores activos
GET    /api/suppliers/top         - Proveedor principal
GET    /api/suppliers/by-amount   - Por monto total
GET    /api/suppliers/stats       - Estad√≠sticas
GET    /api/suppliers/search      - B√∫squeda
```

### **Compras**
```
GET    /api/purchases             - Listar compras
POST   /api/purchases             - Registrar compra
GET    /api/purchases/{id}        - Ver compra
DELETE /api/purchases/{id}        - Eliminar compra
PATCH  /api/purchases/{id}/complete - Completar compra
PATCH  /api/purchases/{id}/cancel  - Cancelar compra
GET    /api/purchases/status/{status} - Por estado
GET    /api/purchases/date-range  - Por rango de fechas
GET    /api/purchases/supplier/{id} - Por proveedor
GET    /api/purchases/stats       - Estad√≠sticas
GET    /api/purchases/monthly     - Totales mensuales
GET    /api/purchases/top-products - Productos m√°s comprados
```

## üîí **Sistema de Autorizaci√≥n**

### **Middleware Implementados**
- `admin` - Solo usuarios con rol admin
- `auth` - Usuarios autenticados

### **Permisos por Endpoint**
- **Crear/Actualizar/Eliminar** - Solo admin
- **Ver/Listar/Buscar** - Usuarios autenticados
- **Completar/Cancelar compras** - Solo admin

## üìù **Ejemplos de Uso**

### **Registrar una Compra**
```php
// POST /api/purchases
{
    "supplier_id": 1,
    "purchase_date": "2024-01-15",
    "notes": "Compra mensual de productos",
    "details": [
        {
            "product_id": 1,
            "quantity": 50,
            "purchase_price": 10.50
        },
        {
            "product_id": 2,
            "quantity": 30,
            "purchase_price": 15.75
        }
    ]
}
```

### **Completar una Compra (Actualiza Stock)**
```php
// PATCH /api/purchases/{id}/complete
// Esto autom√°ticamente:
// 1. Aumenta el stock de cada producto
// 2. Marca la compra como completada
// 3. Actualiza el estado
```

### **Buscar Productos**
```php
// GET /api/products?name=laptop&min_price=500&in_stock=true
// Filtros disponibles:
// - name: B√∫squeda por nombre
// - min_price/max_price: Rango de precios
// - in_stock: Solo con stock disponible
// - low_stock: Solo con stock bajo
// - is_active: Solo activos
```

## üé® **Caracter√≠sticas T√©cnicas**

### **Base de Datos**
- ‚úÖ **Migraciones optimizadas** con √≠ndices para rendimiento
- ‚úÖ **Foreign keys** con restricciones apropiadas
- ‚úÖ **√çndices compuestos** para evitar duplicados
- ‚úÖ **Comentarios descriptivos** en cada campo

### **Validaciones**
- ‚úÖ **Validaciones complejas** con reglas personalizadas
- ‚úÖ **Mensajes en espa√±ol** para mejor UX
- ‚úÖ **Validaciones de negocio** (proveedores activos, productos activos)
- ‚úÖ **Preparaci√≥n autom√°tica** de datos

### **Seguridad**
- ‚úÖ **Autorizaci√≥n por roles** (admin vs usuario)
- ‚úÖ **Validaci√≥n de datos** en cada request
- ‚úÖ **Transacciones de base de datos** para operaciones cr√≠ticas
- ‚úÖ **Middleware de autenticaci√≥n** en todas las rutas

### **Rendimiento**
- ‚úÖ **Eager loading** de relaciones
- ‚úÖ **√çndices de base de datos** optimizados
- ‚úÖ **Paginaci√≥n** para listas grandes
- ‚úÖ **Scopes reutilizables** para consultas comunes

## üîß **Configuraci√≥n y Personalizaci√≥n**

### **Variables de Entorno**
```env
# Configuraci√≥n de base de datos
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=system_inventory
DB_USERNAME=root
DB_PASSWORD=
```

### **Personalizaci√≥n de Validaciones**
```php
// En cualquier FormRequest
public function rules(): array
{
    return [
        'custom_field' => 'required|string|max:255',
        // ... m√°s reglas
    ];
}

public function messages(): array
{
    return [
        'custom_field.required' => 'Mensaje personalizado',
        // ... m√°s mensajes
    ];
}
```

### **Agregar Nuevos Campos**
1. **Crear migraci√≥n** para el nuevo campo
2. **Actualizar modelo** con fillable y casts
3. **Actualizar FormRequest** con validaciones
4. **Actualizar controlador** si es necesario

## üö® **Consideraciones Importantes**

### **Gesti√≥n de Stock**
- ‚ö†Ô∏è **Solo se actualiza al completar compras**
- ‚ö†Ô∏è **No se puede eliminar productos con historial de compras**
- ‚ö†Ô∏è **Stock no puede ser negativo**

### **Integridad de Datos**
- ‚ö†Ô∏è **No se pueden eliminar proveedores con compras**
- ‚ö†Ô∏è **No se pueden eliminar compras completadas**
- ‚ö†Ô∏è **Validaci√≥n de productos duplicados en compras**

### **Rendimiento**
- ‚ö†Ô∏è **Usar paginaci√≥n para listas grandes**
- ‚ö†Ô∏è **Implementar cach√© para estad√≠sticas frecuentes**
- ‚ö†Ô∏è **Monitorear consultas N+1**

## üéâ **¬°Listo para Usar!**

El **M√≥dulo de Inventario** est√° completamente implementado con:

- ‚úÖ **Arquitectura limpia** y mantenible
- ‚úÖ **Validaciones robustas** con FormRequest
- ‚úÖ **Gesti√≥n autom√°tica de stock** al completar compras
- ‚úÖ **Sistema de autorizaci√≥n** por roles
- ‚úÖ **API REST completa** y documentada
- ‚úÖ **Base de datos optimizada** con √≠ndices
- ‚úÖ **C√≥digo comentado** y siguiendo mejores pr√°cticas
- ‚úÖ **Manejo de errores** consistente
- ‚úÖ **Respuestas JSON estandarizadas**

¬°Tu sistema de inventario est√° listo para manejar productos, proveedores y compras de manera profesional y eficiente! üöÄ 